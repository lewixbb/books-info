!function(e){"use strict";var r,l=window.angular,c={signOutUrl:"/api/users/sign-out",signInUrl:"/api/users/sign-in",updateUrl:"/api/session",cache:!1};var s=["ngSession",function(e){return e.resolve()}];var n={configure:function(e){l.isString(e.updateUrl)&&(c.updateUrl=e.updateUrl),l.isString(e.signInUrl)&&(c.signInUrl=e.signInUrl),l.isString(e.signOutUrl)&&(c.signOutUrl=e.signOutUrl),(l.isNumber(e.cache)||"boolean"==typeof e.cache)&&(c.cache=e.cache)},$get:["$rootScope","$http","$q",function(s,t,i){function u(e,n){return n||(n=i.defer()),t.get(c.updateUrl,e).then(function(e,n){s.session.user=n.data,r=new Date,e.resolve(n)}.bind(null,n),n.reject),n.promise}function o(e){var n=s.session;return n?e&&n.user?n.user[e]:n.user:null}return s.session={},{hasRole:function(e,n){var r=o("roles"),s=0;if(!r||!r.length)return!1;l.isString(r)&&(r=[r]),l.isString(e)&&(e=[e]);for(var t=0,i=e.length;t<i;t++)-1<r.indexOf(e[t])&&s++;return n?s===e.length:!!s},signOut:function(e,n){var r=i.defer();return t.post(c.signOutUrl,e,n).then(function(e,n){s.session.user=null,e.resolve(n)}.bind(null,r),r.reject),r.promise},resolve:function(){if(l.isDate(r)){if("boolean"==typeof c.cache&&c.cache)return i.resolve();if(l.isNumber(c.cache)&&r.valueOf()+c.cache>Date.now())return i.resolve()}return u()},signIn:function(e,n){var r=i.defer();return s.session.user=null,t.post(c.signInUrl,e,n).then(function(e){return u(null,e)}.bind(null,r),r.reject),r.promise},reload:function(e,n,r){return r||(r=i.defer()),t.put(c.updateUrl,e,n).then(u.bind(null,n,r),r.reject),r.promise},update:u,user:o,get:function(e){return s.session[e]},set:function(e,n){s.session[e]=n},del:function(e){delete s.session[e]}}}]};l.module("ngSession",[]).provider("ngSession",function(){return n}).run(["$route",function(e){for(var n in e.routes){var r=e.routes[n];l.isObject(r.resolve)||(r.resolve={}),r.resolve._session=s}}])}();
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm5nLXNlc3Npb24uanMiXSwibmFtZXMiOlsid2luZG93IiwidXBkYXRlZEF0IiwibmciLCJhbmd1bGFyIiwiZGVmYXVsdHMiLCJzaWduT3V0VXJsIiwic2lnbkluVXJsIiwidXBkYXRlVXJsIiwiY2FjaGUiLCJzZXNzaW9uUmVzb2x2ZURlZiIsIiRzZXNzaW9uIiwicmVzb2x2ZSIsIm5nU2Vzc2lvblByb3ZpZGVyRGVmIiwiY29uZmlndXJlIiwiY2ZnIiwiaXNTdHJpbmciLCJpc051bWJlciIsIiRnZXQiLCIkcm9vdFNjb3BlIiwiJGh0dHAiLCIkcSIsInVwZGF0ZSIsImNvbmZpZyIsImRlZmVycmVkIiwiZGVmZXIiLCJnZXQiLCJ0aGVuIiwicmVzIiwic2Vzc2lvbiIsInVzZXIiLCJkYXRhIiwiRGF0ZSIsImJpbmQiLCJyZWplY3QiLCJwcm9taXNlIiwicHJvcCIsImhhc1JvbGUiLCJyb2xlcyIsImFsbCIsImFjdHVhbCIsIm1hdGNoZXMiLCJsZW5ndGgiLCJpIiwibCIsImluZGV4T2YiLCJzaWduT3V0IiwicG9zdCIsImlzRGF0ZSIsInZhbHVlT2YiLCJub3ciLCJzaWduSW4iLCJyZWxvYWQiLCJwdXQiLCJzZXQiLCJ2YWx1ZSIsImRlbCIsIm1vZHVsZSIsInByb3ZpZGVyIiwicnVuIiwiJHJvdXRlIiwicGF0aCIsInJvdXRlcyIsInJvdXRlIiwiaXNPYmplY3QiLCJfc2Vzc2lvbiJdLCJtYXBwaW5ncyI6IkNBU0EsU0FBVUEsR0FDUixhQUVBLElBVUlDLEVBVkFDLEVBd1pIRixPQXhaZUcsUUFHWkMsRUFBVyxDQUNiQyxXQUFZLHNCQUNaQyxVQUFXLHFCQUNYQyxVQUFXLGVBQ1hDLE9BQU8sR0FxVFQsSUFBSUMsRUFBb0IsQ0FBQyxZQUx6QixTQUEwQkMsR0FDeEIsT0FBT0EsRUFBU0MsWUF5RWxCLElBQUlDLEVBQXVCLENBQ3pCQyxVQTVCRixTQUFtQkMsR0FFYlosRUFBR2EsU0FBU0QsRUFBSVAsYUFDbEJILEVBQVNHLFVBQVlPLEVBQUlQLFdBSXZC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QUFhcEIsVUFDSmpCLEVBQVdVLFFBQVFPLFFBbUg5QmpDLEVBQUdzRCxPQUFPLFlBQWEsSUFHcEJDLFNBQVMsWUFSWixXQUNFLE9BQU83QyxJQVVOOEMsSUFBSSxDQUFDLFNBcEZSLFNBQXdCQyxHQUN0QixJQUFLLElBQUlDLEtBQVFELEVBQU9FLE9BQVEsQ0FDOUIsSUFBSUMsRUFBUUgsRUFBT0UsT0FBT0QsR0FFckIxRCxFQUFHNkQsU0FBU0QsRUFBTW5ELFdBQ3JCbUQsRUFBTW5ELFFBQVUsSUFHbEJtRCxFQUFNbkQsUUFBUXFELFNBQVd2RCxNQTlVL0IiLCJmaWxlIjoibmctc2Vzc2lvbi5qcyIsInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogbmdTZXNzaW9uXG4gKlxuICogQGRlc2NyaXB0aW9uIFNlc3Npb24gaGFuZGxlciBtb2R1bGUgZm9yIEFuZ3VsYXJKUy5cbiAqIEBtb2R1bGUgbmdTZXNzaW9uXG4gKiBAYXV0aG9yIEZpbmFsIERldmVsb3BtZW50IFN0dWRpb1xuICogQGxpY2Vuc2UgTUlUXG4gKi9cblxuKGZ1bmN0aW9uKHdpbmRvdykge1xuICAndXNlIHN0cmljdCc7XG5cbiAgdmFyIG5nID0gd2luZG93LmFuZ3VsYXI7XG5cbiAgLyogRGVmYXVsdCBjb25maWd1cmF0aW9uICovXG4gIHZhciBkZWZhdWx0cyA9IHtcbiAgICBzaWduT3V0VXJsOiAnL2FwaS91c2Vycy9zaWduLW91dCcsXG4gICAgc2lnbkluVXJsOiAnL2FwaS91c2Vycy9zaWduLWluJyxcbiAgICB1cGRhdGVVcmw6ICcvYXBpL3Nlc3Npb24nLFxuICAgIGNhY2hlOiBmYWxzZVxuICB9O1xuXG4gIHZhciB1cGRhdGVkQXQ7XG5cbiAgLyoqXG4gICAqIG5nU2Vzc2lvbiBzZXJ2aWNlIGZ1bmN0aW9uLlxuICAgKlxuICAgKiBAcHJpdmF0ZVxuICAgKi9cbiAgZnVuY3Rpb24gbmdTZXNzaW9uU2VydmljZUZuKCRyb290U2NvcGUsICRodHRwLCAkcSkge1xuICAgICRyb290U2NvcGUuc2Vzc2lvbiA9IHt9O1xuXG4gICAgLyoqXG4gICAgICogQG1vZHVsZSBuZ1Nlc3Npb25cbiAgICAgKiBAZGVzY3JpcHRpb24gbmdTZXNzaW9uIFNlcnZpY2VcbiAgICAgKi9cblxuICAgIC8qKlxuICAgICAqIFNlc3Npb24gdXBkYXRlIHN1Y2Nlc3NmdWwuXG4gICAgICpcbiAgICAgKiBAcHJpdmF0ZVxuICAgICAqL1xuICAgIGZ1bmN0aW9uIG9uU2Vzc2lvblVwZGF0ZVN1Y2Nlc3MoZGVmZXJyZWQsIHJlcykge1xuICAgICAgJHJvb3RTY29wZS5zZXNzaW9uLnVzZXIgPSByZXMuZGF0YTtcblxuICAgICAgdXBkYXRlZEF0ID0gbmV3IERhdGUoKTtcblxuICAgICAgZGVmZXJyZWQucmVzb2x2ZShyZXMpO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIE9uIFNpZ24gSW4gc3VjY2Vzcy5cbiAgICAgKlxuICAgICAqIEBwcml2YXRlXG4gICAgICovXG4gICAgZnVuY3Rpb24gb25TaW5nSW5TdWNjZXNzKGRlZmVycmVkKSB7XG4gICAgICByZXR1cm4gdXBkYXRlKG51bGwsIGRlZmVycmVkKTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBPbiBTaWduIE91dCBzdWNjZXNzLlxuICAgICAqXG4gICAgICogQHByaXZhdGVcbiAgICAgKi9cbiAgICBmdW5jdGlvbiBvblNpbmdPdXRTdWNjZXNzKGRlZmVycmVkLCByZXMpIHtcbiAgICAgICRyb290U2NvcGUuc2Vzc2lvbi51c2VyID0gbnVsbDtcblxuICAgICAgZGVmZXJyZWQucmVzb2x2ZShyZXMpO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFNpZ25zIGEgdXNlciBpbi5cbiAgICAgKlxuICAgICAqIEl0IHdpbGwgcGVyZm9ybSBhIGBQT1NUYCB0byB0aGUgYGRlZmF1bHRzLnNpZ25PdXRVcmxgIHBhdGggYW5kIHBlcmZvcm0gYW5cbiAgICAgKiBgdXBkYXRlYCBpZiBzdWNjZXNzZnVsLlxuICAgICAqXG4gICAgICogQHBhcmFtIHtPYmplY3R9IGRhdGEgVGhlIGRhdGEgdG8gc2VuZCBmb3Igc2lnbiBpbi5cbiAgICAgKiBAcGFyYW0ge09iamVjdH0gY29uZmlnIE9wdGlvbmFsIEFuZ3VsYXJKUyBIVFRQIHJlcXVlc3QgY29uZmlndXJhdGlvbi5cbiAgICAgKlxuICAgICAqIEByZXR1cm5zIHtQcm9taXNlfSBBIHByb21pc2UgcmVzb2x2aW5nIHRoZSByZXF1ZXN0J3MgYHJlc2Agb2JqZWN0LlxuICAgICAqXG4gICAgICogQGV4YW1wbGVcbiAgICAgKiBuZ1Nlc3Npb24uc2lnbkluKCRzY29wZS5kYXRhKVxuICAgICAqICAgLnRoZW4oZnVuY3Rpb24gKHJlcykge30pXG4gICAgICogICAuY2F0Y2goZnVuY3Rpb24gKHJlcykge30pXG4gICAgICovXG4gICAgZnVuY3Rpb24gc2lnbkluKGRhdGEsIGNvbmZpZykge1xuICAgICAgdmFyIGRlZmVycmVkID0gJHEuZGVmZXIoKTtcblxuICAgICAgLyogUmVtb3ZlIHByZXZpb3VzIHVzZXIgb2JqZWN0ICovXG4gICAgICAkcm9vdFNjb3BlLnNlc3Npb24udXNlciA9IG51bGw7XG5cbiAgICAgICRodHRwLnBvc3QoZGVmYXVsdHMuc2lnbkluVXJsLCBkYXRhLCBjb25maWcpLnRoZW4ob25TaW5nSW5TdWNjZXNzLmJpbmQobnVsbCwgZGVmZXJyZWQpLCBkZWZlcnJlZC5yZWplY3QpO1xuXG4gICAgICByZXR1cm4gZGVmZXJyZWQucHJvbWlzZTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBTaWducyBhIHVzZXIgb3V0LlxuICAgICAqXG4gICAgICogSXQgd2lsbCBwZXJmb3JtIGEgUE9TVCB0byB0aGUgYGRlZmF1bHRzLnNpZ25PdXRVcmxgIHBhdGggYW5kIGRlbGV0ZSB0aGVcbiAgICAgKiB1c2VyIG9iamVjdCBvbiBzdWNjZXNzLlxuICAgICAqXG4gICAgICogQHBhcmFtIHtPYmplY3R9IGRhdGEgVGhlIG9wdGlvbmFsIGRhdGEgdG8gc2VuZCBmb3Igc2lnbiBvdXQuXG4gICAgICogQHBhcmFtIHtPYmplY3R9IGNvbmZpZyBPcHRpb25hbCBBbmd1bGFySlMgSFRUUCByZXF1ZXN0IGNvbmZpZ3VyYXRpb24uXG4gICAgICpcbiAgICAgKiBAcmV0dXJucyB7UHJvbWlzZX0gQSBwcm9taXNlIHJlc29sdmluZyB0aGUgcmVxdWVzdCdzIGByZXNgIG9iamVjdC5cbiAgICAgKlxuICAgICAqIEBleGFtcGxlXG4gICAgICogbmdTZXNzaW9uLnNpZ25PdXQoJHNjb3BlLmRhdGEpXG4gICAgICogICAudGhlbihmdW5jdGlvbiAocmVzKSB7fSlcbiAgICAgKiAgIC5jYXRjaChmdW5jdGlvbiAocmVzKSB7fSlcbiAgICAgKi9cbiAgICBmdW5jdGlvbiBzaWduT3V0KGRhdGEsIGNvbmZpZykge1xuICAgICAgdmFyIGRlZmVycmVkID0gJHEuZGVmZXIoKTtcblxuICAgICAgJGh0dHAucG9zdChkZWZhdWx0cy5zaWduT3V0VXJsLCBkYXRhLCBjb25maWcpLnRoZW4ob25TaW5nT3V0U3VjY2Vzcy5iaW5kKG51bGwsIGRlZmVycmVkKSwgZGVmZXJyZWQucmVqZWN0KTtcblxuICAgICAgcmV0dXJuIGRlZmVycmVkLnByb21pc2U7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogUmVzb2x2ZXMgdGhlIFNlc3Npb24gdXNpbmcgY2FjaGUgaWYgYXZhaWxhYmxlLlxuICAgICAqL1xuICAgIGZ1bmN0aW9uIHJlc29sdmUoKSB7XG4gICAgICBpZiAobmcuaXNEYXRlKHVwZGF0ZWRBdCkpIHtcbiAgICAgICAgaWYgKHR5cGVvZiBkZWZhdWx0cy5jYWNoZSA9PSAnYm9vbGVhbicgJiYgZGVmYXVsdHMuY2FjaGUpIHtcbiAgICAgICAgICByZXR1cm4gJHEucmVzb2x2ZSgpO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKG5nLmlzTnVtYmVyKGRlZmF1bHRzLmNhY2hlKSAmJiB1cGRhdGVkQXQudmFsdWVPZigpICsgZGVmYXVsdHMuY2FjaGUgPiBEYXRlLm5vdygpKSB7XG4gICAgICAgICAgcmV0dXJuICRxLnJlc29sdmUoKTtcbiAgICAgICAgfVxuICAgICAgfVxuXG4gICAgICByZXR1cm4gdXBkYXRlKCk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogUmVsb2FkcyB0aGUgc2Vzc2lvbiB1c2VyIG9iamVjdC5cbiAgICAgKlxuICAgICAqIEl0IHdpbGwgcGVyZm9ybSBhIFBVVCB0byB0aGUgYGRlZmF1bHRzLnVwZGF0ZVVybGAgcGF0aCBhbmQgdGhlbiBhXG4gICAgICogY29uc2VjdWVudCBzZXNzaW9uIGB1cGRhdGVgLlxuICAgICAqXG4gICAgICogVGhlIHNlcnZlciBzaG91bGQgaGFuZGxlIHRoZSBPVXQgcmVxdWVzdCBhcyBhIHJlbG9hZCByZXF1ZXN0IGFuZCBmZXRjaFxuICAgICAqIHVwZGF0ZWQgc2Vzc2lvbiBkYXRhLlxuICAgICAqXG4gICAgICogQHBhcmFtIHtPYmplY3R9IGRhdGEgVGhlIG9wdGlvbmFsIGRhdGEgdG8gc2VuZCBmb3IgdGhlIHJlbG9hZC5cbiAgICAgKiBAcGFyYW0ge09iamVjdH0gY29uZmlnIE9wdGlvbmFsIEFuZ3VsYXJKUyBIVFRQIHJlcXVlc3QgY29uZmlndXJhdGlvbi5cbiAgICAgKiBAcGFyYW0ge1Byb21pc2V9IGRlZmVycmVkIE9wdGlvbmFsIGRlZmVycmVkIHByb21pc2Ugb2JqZWN0LlxuICAgICAqXG4gICAgICogQHJldHVybnMge1Byb21pc2V9IEEgcHJvbWlzZSByZXNvbHZpbmcgdGhlIHJlcXVlc3QncyBgcmVzYCBvYmplY3QuXG4gICAgICpcbiAgICAgKiBAZXhhbXBsZVxuICAgICAqIG5nU2Vzc2lvbi5yZWxvYWQoJHNjb3BlLmRhdGEpXG4gICAgICogICAudGhlbihmdW5jdGlvbiAocmVzKSB7fSlcbiAgICAgKiAgIC5jYXRjaChmdW5jdGlvbiAocmVzKSB7fSlcbiAgICAgKi9cbiAgICBmdW5jdGlvbiByZWxvYWQoZGF0YSwgY29uZmlnLCBkZWZlcnJlZCkge1xuICAgICAgaWYgKCFkZWZlcnJlZCkge1xuICAgICAgICBkZWZlcnJlZCA9ICRxLmRlZmVyKCk7XG4gICAgICB9XG5cbiAgICAgIC8qIFJlbG9hZHMgY3VycmVudCBzZXNzaW9uICovXG4gICAgICAkaHR0cC5wdXQoZGVmYXVsdHMudXBkYXRlVXJsLCBkYXRhLCBjb25maWcpLnRoZW4odXBkYXRlLmJpbmQobnVsbCwgY29uZmlnLCBkZWZlcnJlZCksIGRlZmVycmVkLnJlamVjdCk7XG5cbiAgICAgIHJldHVybiBkZWZlcnJlZC5wcm9taXNlO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFVwZGF0ZXMgdGhlIHNlc3Npb24gdXNlciBvYmplY3QuXG4gICAgICpcbiAgICAgKiBJdCB3aWxsIHBlcmZvcm0gYSBHRVQgdG8gdGhlIGBkZWZhdWx0cy51cGRhdGVVcmxgIHBhdGggYW5kIHNldCB0aGVcbiAgICAgKiBzZXNzaW9uJ3MgdXNlciBvYmplY3Qgb24gc3VjY2VzcyB3aXRoIHRoZSByZXF1ZXN0J3MgYHJlcy5kYXRhYC5cbiAgICAgKlxuICAgICAqIEBwYXJhbSB7T2JqZWN0fSBjb25maWcgT3B0aW9uYWwgQW5ndWxhckpTIEhUVFAgcmVxdWVzdCBjb25maWd1cmF0aW9uLlxuICAgICAqIEBwYXJhbSB7UHJvbWlzZX0gZGVmZXJyZWQgT3B0aW9uYWwgZGVmZXJyZWQgcHJvbWlzZSBvYmplY3QuXG4gICAgICpcbiAgICAgKiBAcmV0dXJucyB7UHJvbWlzZX0gQSBwcm9taXNlIHJlc29sdmluZyB0aGUgcmVxdWVzdCdzIGByZXNgIG9iamVjdC5cbiAgICAgKlxuICAgICAqIEBleGFtcGxlXG4gICAgICogbmdTZXNzaW9uLnVwZGF0ZSgpXG4gICAgICogICAudGhlbihmdW5jdGlvbiAocmVzKSB7fSlcbiAgICAgKiAgIC5jYXRjaChmdW5jdGlvbiAocmVzKSB7fSlcbiAgICAgKi9cbiAgICBmdW5jdGlvbiB1cGRhdGUoY29uZmlnLCBkZWZlcnJlZCkge1xuICAgICAgaWYgKCFkZWZlcnJlZCkge1xuICAgICAgICBkZWZlcnJlZCA9ICRxLmRlZmVyKCk7XG4gICAgICB9XG5cbiAgICAgIC8qIFJldHJpZXZlIGN1cnJlbnQgc2Vzc2lvbiAqL1xuICAgICAgJGh0dHAuZ2V0KGRlZmF1bHRzLnVwZGF0ZVVybCwgY29uZmlnKS50aGVuKG9uU2Vzc2lvblVwZGF0ZVN1Y2Nlc3MuYmluZChudWxsLCBkZWZlcnJlZCksIGRlZmVycmVkLnJlamVjdCk7XG5cbiAgICAgIHJldHVybiBkZWZlcnJlZC5wcm9taXNlO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFJldHJpZXZlcyBhIHVzZXIgZGF0YSB2YWx1ZSBieSBwcm9wZXJ0eSBuYW1lLlxuICAgICAqXG4gICAgICogQHBhcmFtIHtTdHJpbmd9IHByb3AgVGhlIHByb3BlcnR5IG5hbWUgdG8gcmV0cmlldmUuXG4gICAgICpcbiAgICAgKiBAcmV0dXJucyB7TWl4ZWR9IFRoZSBwcm9wZXJ0eSdzIHZhbHVlIG9yIHRoZSB1c2VyIG9iamVjdCBpZiBub1xuICAgICAqIHByb3BlcnR5IG5hbWUgaXMgcHJvdmlkZWQuXG4gICAgICpcbiAgICAgKiBAZXhhbXBsZSBuZ1Nlc3Npb24udXNlcignbmFtZScpOyAvLyA9PiAnSm9obiBTbWl0aCdcbiAgICAgKi9cbiAgICBmdW5jdGlvbiB1c2VyKHByb3ApIHtcbiAgICAgIHZhciBzZXNzaW9uID0gJHJvb3RTY29wZS5zZXNzaW9uO1xuXG4gICAgICBpZiAoIXNlc3Npb24pIHtcbiAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICB9XG5cbiAgICAgIGlmIChwcm9wICYmIHNlc3Npb24udXNlcikge1xuICAgICAgICByZXR1cm4gc2Vzc2lvbi51c2VyW3Byb3BdO1xuICAgICAgfVxuXG4gICAgICByZXR1cm4gc2Vzc2lvbi51c2VyO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIENoZWNrcyBpZiB0aGUgY3VycmVudCB1c2VyIGhhcyBhbnkgb3IgYWxsIG9mIHRoZSBwcm92aWRlZCByb2xlcy5cbiAgICAgKlxuICAgICAqIEBwYXJhbSB7KFN0cmluZ3xTdHJpbmdbXSl9IHJvbGVzIFRoZSByZXF1aXJlZCByb2xlcy5cbiAgICAgKiBAcGFyYW0ge0Jvb2xlYW59IGFsbCBJZiBhbGwgdGhlIHByb3ZpZGVkIHJvbGVzIGFyZSByZXF1aXJlZC5cbiAgICAgKlxuICAgICAqIEByZXR1cm4ge0Jvb2xlYW59XG4gICAgICpcbiAgICAgKiBAZXhhbXBsZVxuICAgICAqIG5nU2Vzc2lvbi5oYXNSb2xlKCdST0xFLkFETUlOJyk7IC8vID0+IGZhbHNlXG4gICAgICogbmdTZXNzaW9uLmhhc1JvbGUoJ1JPTEUuVVNFUicpOyAvLyA9PiB0cnVlXG4gICAgICogbmdTZXNzaW9uLmhhc1JvbGUoWydST0xFLkFETUlOJywgJ1JPTEUuVVNFUiddKTsgLy8gPT4gdHJ1ZVxuICAgICAqIG5nU2Vzc2lvbi5oYXNSb2xlKFsnUk9MRS5BRE1JTicsICdST0xFLlVTRVInXSwgdHJ1ZSk7IC8vID0+IGZhbHNlXG4gICAgICovXG4gICAgZnVuY3Rpb24gaGFzUm9sZShyb2xlcywgYWxsKSB7XG4gICAgICB2YXIgYWN0dWFsID0gdXNlcigncm9sZXMnKTtcbiAgICAgIHZhciBtYXRjaGVzID0gMDtcblxuICAgICAgaWYgKCFhY3R1YWwgfHwgIWFjdHVhbC5sZW5ndGgpIHtcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgfVxuXG4gICAgICBpZiAobmcuaXNTdHJpbmcoYWN0dWFsKSkge1xuICAgICAgICBhY3R1YWwgPSBbYWN0dWFsXTtcbiAgICAgIH1cblxuICAgICAgaWYgKG5nLmlzU3RyaW5nKHJvbGVzKSkge1xuICAgICAgICByb2xlcyA9IFtyb2xlc107XG4gICAgICB9XG5cbiAgICAgIGZvciAodmFyIGkgPSAwLCBsID0gcm9sZXMubGVuZ3RoOyBpIDwgbDsgaSsrKSB7XG4gICAgICAgIGlmIChhY3R1YWwuaW5kZXhPZihyb2xlc1tpXSkgPiAtMSkge1xuICAgICAgICAgIG1hdGNoZXMrKztcbiAgICAgICAgfVxuICAgICAgfVxuXG4gICAgICBpZiAoYWxsKSB7XG4gICAgICAgIHJldHVybiBtYXRjaGVzID09PSByb2xlcy5sZW5ndGg7XG4gICAgICB9XG5cbiAgICAgIHJldHVybiAhIW1hdGNoZXM7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogU2V0cyBhIHZhbHVlIGluIHRoZSBzZXNzaW9uIG9iamVjdC5cbiAgICAgKlxuICAgICAqIEBwYXJhbSB7U3RyaW5nfSBwcm9wIFRoZSBwcm9wZXJ0eSBuYW1lIHRvIHNldC5cbiAgICAgKiBAcGFyYW0ge01peGVkfSBUaGUgcHJvcGVydHkgdmFsdWUgdG8gc2V0LlxuICAgICAqXG4gICAgICogQGV4YW1wbGUgbmdTZXNzaW9uLnNldCgndGVzdCcsICdUZXN0IFZhbHVlJyk7XG4gICAgICovXG4gICAgZnVuY3Rpb24gc2V0KHByb3AsIHZhbHVlKSB7XG4gICAgICAkcm9vdFNjb3BlLnNlc3Npb25bcHJvcF0gPSB2YWx1ZTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBPYnRhaW5zIGEgdmFsdWUgZnJvbSB0aGUgc2Vzc2lvbiBvYmplY3QuXG4gICAgICpcbiAgICAgKiBAcGFyYW0ge1N0cmluZ30gcHJvcCBUaGUgcHJvcGVydHkgbmFtZSB0byBvYnRhaW4uXG4gICAgICpcbiAgICAgKiBAcmV0dXJucyB7TWl4ZWR9IFRoZSBwcm9wZXJ0eSdzIHZhbHVlLlxuICAgICAqXG4gICAgICogQGV4YW1wbGUgbmdTZXNzaW9uLmdldCgndGVzdCcpOyAvLyA9PiAnVGVzdCBWYWx1ZSdcbiAgICAgKi9cbiAgICBmdW5jdGlvbiBnZXQocHJvcCkge1xuICAgICAgcmV0dXJuICRyb290U2NvcGUuc2Vzc2lvbltwcm9wXTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBEZWxldGVzIGEgcHJvcGVydHkgZnJvbSB0aGUgc2Vzc2lvbiBvYmplY3QuXG4gICAgICpcbiAgICAgKiBAcGFyYW0ge1N0cmluZ30gcHJvcCBUaGUgcHJvcGVydHkgbmFtZS5cbiAgICAgKlxuICAgICAqIEBleGFtcGxlXG4gICAgICogbmdTZXNzaW9uLmRlbCgndGVzdCcpO1xuICAgICAqIG5nU2Vzc2lvbi5nZXQoJ3Rlc3QnKTsgLy8gPT4gbnVsbFxuICAgICAqL1xuICAgIGZ1bmN0aW9uIGRlbChwcm9wKSB7XG4gICAgICBkZWxldGUgJHJvb3RTY29wZS5zZXNzaW9uW3Byb3BdO1xuICAgIH1cblxuICAgIC8qIFNlc3Npb24gc2VydmljZSBkZWZpbml0aW9uICovXG4gICAgdmFyIG5nU2Vzc2lvblNlcnZpY2VEZWYgPSB7XG4gICAgICBoYXNSb2xlOiBoYXNSb2xlLFxuICAgICAgc2lnbk91dDogc2lnbk91dCxcbiAgICAgIHJlc29sdmU6IHJlc29sdmUsXG4gICAgICBzaWduSW46IHNpZ25JbixcbiAgICAgIHJlbG9hZDogcmVsb2FkLFxuICAgICAgdXBkYXRlOiB1cGRhdGUsXG4gICAgICB1c2VyOiB1c2VyLFxuICAgICAgZ2V0OiBnZXQsXG4gICAgICBzZXQ6IHNldCxcbiAgICAgIGRlbDogZGVsXG4gICAgfTtcblxuICAgIHJldHVybiBuZ1Nlc3Npb25TZXJ2aWNlRGVmO1xuICB9XG5cbiAgLyoqXG4gICAqIFNlc3Npb24gcmVzb2x2ZSBjYWxsYmFjayBmdW5jdGlvbi5cbiAgICpcbiAgICogQHByaXZhdGVcbiAgICovXG4gIGZ1bmN0aW9uIHNlc3Npb25SZXNvbHZlRm4oJHNlc3Npb24pIHtcbiAgICByZXR1cm4gJHNlc3Npb24ucmVzb2x2ZSgpO1xuICB9XG5cbiAgLyogU2Vzc2lvbiByZXNvbHZlIGRlZmluaXRpb24gKi9cbiAgdmFyIHNlc3Npb25SZXNvbHZlRGVmID0gWyduZ1Nlc3Npb24nLCBzZXNzaW9uUmVzb2x2ZUZuXTtcblxuICAvKipcbiAgICogbmdTZXNzaW9uIHJ1biBmdW5jdGlvbi5cbiAgICpcbiAgICogQHByaXZhdGVcbiAgICovXG4gIGZ1bmN0aW9uIG5nU2Vzc2lvblJ1bkZuKCRyb3V0ZSkge1xuICAgIGZvciAodmFyIHBhdGggaW4gJHJvdXRlLnJvdXRlcykge1xuICAgICAgdmFyIHJvdXRlID0gJHJvdXRlLnJvdXRlc1twYXRoXTtcblxuICAgICAgaWYgKCFuZy5pc09iamVjdChyb3V0ZS5yZXNvbHZlKSkge1xuICAgICAgICByb3V0ZS5yZXNvbHZlID0ge307XG4gICAgICB9XG5cbiAgICAgIHJvdXRlLnJlc29sdmUuX3Nlc3Npb24gPSBzZXNzaW9uUmVzb2x2ZURlZjtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogQG1vZHVsZSBuZ1Nlc3Npb25Qcm92aWRlclxuICAgKiBAZGVzY3JpcHRpb24gbmdTZXNzaW9uIFByb3ZpZGVyXG4gICAqL1xuXG4gIC8qKlxuICAgKiBDb25maWd1cmF0aW9uIG1ldGhvZC5cbiAgICpcbiAgICogQHBhcmFtIHtPYmplY3R9IGNmZyBUaGUgY29uZmlndXJhdGlvbiBvYmplY3QuXG4gICAqIEBwYXJhbSB7T2JqZWN0fSBjZmcudXBkYXRlVXJsIFRoZSBzZXNzaW9uIHVwZGF0ZSBVUkwgKEdFVHxQVVQpLlxuICAgKiBAcGFyYW0ge09iamVjdH0gY2ZnLnNpZ25JblVybCBUaGUgc2Vzc2lvbiBzaWduIGluIFVSTCAoUE9TVCkuXG4gICAqIEBwYXJhbSB7T2JqZWN0fSBjZmcuc2lnbk91dFVybCBUaGUgc2Vzc2lvbiBzaWduIG91dCBVUkwgKFBPU1QpLlxuICAgKiBAcGFyYW0ge051bWJlcnxCb29sZWFufSBjZmcuY2FjaGUgVGhlIHNlc3Npb24gY2FjaGUgYmVoYXZpb3IuIE51bWJlciBpcyB0aGUgbWlsbGlzZWNvbmRzIHRvIGNhY2hlIHRoZSBzZXNzaW9uIGZvci5cbiAgICogQSBib29sZWFuIFwidHJ1ZVwiIHdpbGwgY2FjaGUgdGhlIHNlc3Npb24gZm9yZXZlci5cbiAgICpcbiAgICogQGV4YW1wbGVcbiAgICogbmdTZXNzaW9uUHJvdmlkZXIuY29uZmlndXJlKHtcbiAgICogICBzaWduT3V0VXJsOiAnL2FwaS91c2Vycy9zaWduLW91dCcsXG4gICAqICAgc2lnbkluVXJsOiAnL2FwaS91c2Vycy9zaWduLWluJyxcbiAgICogICB1cGRhdGVVcmw6ICcvYXBpL3Nlc3Npb24nLFxuICAgKiAgIGNhY2hlOiAnMWgnXG4gICAqIH0pO1xuICAgKi9cbiAgZnVuY3Rpb24gY29uZmlndXJlKGNmZykge1xuICAgIC8qIFNldHMgc2Vzc2lvbiB1cGRhdGUgR0VUIFVSTCAqL1xuICAgIGlmIChuZy5pc1N0cmluZyhjZmcudXBkYXRlVXJsKSkge1xuICAgICAgZGVmYXVsdHMudXBkYXRlVXJsID0gY2ZnLnVwZGF0ZVVybDtcbiAgICB9XG5cbiAgICAvKiBTZXRzIHNpZ24gaW4gUE9TVCBVUkwgKi9cbiAgICBpZiAobmcuaXNTdHJpbmcoY2ZnLnNpZ25JblVybCkpIHtcbiAgICAgIGRlZmF1bHRzLnNpZ25JblVybCA9IGNmZy5zaWduSW5Vcmw7XG4gICAgfVxuXG4gICAgLyogU2V0cyBzaWduIG91dCBQT1NUIFVSTCAqL1xuICAgIGlmIChuZy5pc1N0cmluZyhjZmcuc2lnbk91dFVybCkpIHtcbiAgICAgIGRlZmF1bHRzLnNpZ25PdXRVcmwgPSBjZmcuc2lnbk91dFVybDtcbiAgICB9XG5cbiAgICAvKiBTZXRzIHRoZSBjYWNoZSBiZWhhdmlvciAqL1xuICAgIGlmIChuZy5pc051bWJlcihjZmcuY2FjaGUpIHx8IHR5cGVvZiBjZmcuY2FjaGUgPT0gJ2Jvb2xlYW4nKSB7XG4gICAgICBkZWZhdWx0cy5jYWNoZSA9IGNmZy5jYWNoZTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogbmdTZXNzaW9uIHByb3ZpZGVyIGRlZmluaXRpb24uXG4gICAqXG4gICAqIEBwcml2YXRlXG4gICAqL1xuICB2YXIgbmdTZXNzaW9uUHJvdmlkZXJEZWYgPSB7XG4gICAgY29uZmlndXJlOiBjb25maWd1cmUsXG5cbiAgICAkZ2V0OiBbJyRyb290U2NvcGUnLCAnJGh0dHAnLCAnJHEnLCBuZ1Nlc3Npb25TZXJ2aWNlRm5dXG4gIH07XG5cbiAgLyoqXG4gICAqIG5nU2Vzc2lvbiBwcm92aWRlciBmdW5jdGlvbi5cbiAgICpcbiAgICogQHByaXZhdGVcbiAgICovXG4gIGZ1bmN0aW9uIG5nU2Vzc2lvblByb3ZpZGVyRm4oKSB7XG4gICAgcmV0dXJuIG5nU2Vzc2lvblByb3ZpZGVyRGVmO1xuICB9XG5cbiAgLyogRGVmaW5lIEFuZ3VsYXJKUyBtb2R1bGUgKi9cbiAgbmcubW9kdWxlKCduZ1Nlc3Npb24nLCBbXSlcblxuICAgIC8qIERlZmluZSBzZXJ2aWNlIHByb3ZpZGVyICovXG4gICAgLnByb3ZpZGVyKCduZ1Nlc3Npb24nLCBuZ1Nlc3Npb25Qcm92aWRlckZuKVxuXG4gICAgLyogRGVmaW5lIEFuZ3VsYXJKUyBtb2R1bGUgcnVuIGZ1bmN0aW9uICovXG4gICAgLnJ1bihbJyRyb3V0ZScsIG5nU2Vzc2lvblJ1bkZuXSk7XG59KSh3aW5kb3cpO1xuIl19
